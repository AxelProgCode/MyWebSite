<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>Cassa</title>
</head>
<body>
    <div class="interface">
        <!-- Pannello sinistro: Prodotti -->
        <div class="panel-left">
            <!-- Header mobile -->
            <div class="mobile-header">
                <h2>Prodotti</h2>
                <div class="total-mobile">
                    <span id="mobileTotal">‚Ç¨ 0,00</span>
                </div>
            </div>

            <!-- Categorie -->
            <div class="category-buttons" id="categoryButtons">
                <!-- I bottoni categoria verranno iniettati qui da JS -->
            </div>

            <!-- Prodotti -->
            <div class="product-buttons" id="productButtons">
                <!-- I bottoni prodotto verranno iniettati qui da JS -->
            </div>
        </div>

        <!-- Pannello destro: Ordine -->
        <div class="panel-right order-section" id="orderSection">
            <h2>Ordine</h2>
            
            <!-- Lista articoli -->
            <div class="items-list" id="itemsList">
                <!-- Le righe degli articoli verranno aggiunte qui -->
            </div>

            <!-- Totale -->
            <div class="total-area" id="totalDisplay">
                Totale: ‚Ç¨ 0,00
            </div>

            <!-- Bottoni azione -->
            <div class="action-buttons">
                <button class="clear-btn" onclick="clearOrder()">Cancella</button>
                <button class="pay-btn" onclick="checkout()">Paga Ordine</button>
            </div>
        </div>
    </div>

    <script>
        // JavaScript Integrato con logica gestionale e categorie
        let currentOrder = [];
        let activeRowElement = null;
        let activeCategory = 'Tutto';

        // Elementi DOM
        const itemsList = document.getElementById('itemsList');
        const totalDisplay = document.getElementById('totalDisplay');
        const productButtonsArea = document.getElementById('productButtons');
        const categoryButtonsArea = document.getElementById('categoryButtons');
        const orderSection = document.getElementById('orderSection');
        const mobileTotal = document.getElementById('mobileTotal');
        const mobileTotalFooter = document.getElementById('mobileTotalFooter');

        // Database prodotti
        const products = [
            // Prodotti Bar
            { id: 1, name: 'Caff√®', price: 1.20, category: 'Bar', icon: '‚òï' },
            { id: 2, name: 'Cappuccino', price: 2.00, category: 'Bar', icon: 'ü•õ' },
            { id: 3, name: 'Brioches', price: 1.50, category: 'Bar', icon: 'ü•ê' },
            { id: 8, name: 'Caff√® Decaffeinato', price: 1.30, category: 'Bar', icon: '‚òï' },
            { id: 9, name: 'Latte Macchiato', price: 2.20, category: 'Bar', icon: 'ü•õ' },
            { id: 10, name: 'Spremuta d\'Arancia', price: 3.50, category: 'Bar', icon: 'üçä' },

            // Prodotti Cibo (Colazione/Pranzo/Dolci)
            { id: 4, name: 'French Toast', price: 5.50, category: 'Cibo', icon: 'üçû' },
            { id: 5, name: 'Torta della casa', price: 4.50, category: 'Cibo', icon: 'üç∞' },
            { id: 11, name: 'Panino Prosciutto e Formaggio', price: 6.00, category: 'Cibo', icon: 'ü•™' },
            { id: 12, name: 'Insalata Caesar', price: 8.50, category: 'Cibo', icon: 'ü•ó' },
            { id: 13, name: 'Piatto Vegano del Giorno', price: 9.50, category: 'Cibo', icon: 'ü•¶' },
            { id: 14, name: 'Muffin al Cioccolato', price: 2.50, category: 'Cibo', icon: 'üßÅ' },
            { id: 15, name: 'Patatine Fritte', price: 3.00, category: 'Cibo', icon: 'üçü' },

            // Prodotti Bevande
            { id: 6, name: 'Acqua Naturale 0.5L', price: 1.00, category: 'Bevande', icon: 'üíß' },
            { id: 7, name: 'Birra Media chiara', price: 4.00, category: 'Bevande', icon: 'üç∫' },
            { id: 16, name: 'Acqua Frizzante 0.5L', price: 1.00, category: 'Bevande', icon: 'üíß' },
            { id: 17, name: 'Coca Cola 33cl', price: 2.50, category: 'Bevande', icon: 'ü•§' },
            { id: 18, name: 'Calice di Vino Rosso', price: 4.50, category: 'Bevande', icon: 'üç∑' },
            { id: 19, name: 'Succo di Frutta (Pera)', price: 2.80, category: 'Bevande', icon: 'üßÉ' }
        ];

        // --- Gestione Categorie ---
        function renderCategories() {
            const categories = ['Tutto', ...new Set(products.map(p => p.category))];
            categoryButtonsArea.innerHTML = '';

            categories.forEach(category => {
                const button = document.createElement('button');
                button.className = 'cat-btn';
                button.textContent = category;
                button.onclick = () => filterProductsByCategory(category);
                if (category === activeCategory) {
                    button.classList.add('active-category');
                }
                categoryButtonsArea.appendChild(button);
            });
        }

        function filterProductsByCategory(categoryName) {
            activeCategory = categoryName;
            renderCategories();
            renderProducts();
        }

        // --- Gestione Prodotti ---
        function renderProducts() {
            productButtonsArea.innerHTML = '';
            const filteredProducts = activeCategory === 'Tutto' 
                ? products 
                : products.filter(p => p.category === activeCategory);

            filteredProducts.forEach(product => {
                const button = document.createElement('button');
                button.className = 'prod-btn';
                button.innerHTML = `
                    <div class="product-icon">${product.icon || 'üç¥'}</div>
                    <strong>${product.name}</strong>
                    <small>‚Ç¨${product.price.toFixed(2).replace('.', ',')}</small>
                `;
                button.onclick = () => addItem(product);
                productButtonsArea.appendChild(button);
            });
        }

        // --- Gestione Ordine ---
        function addItem(product, quantity = 1) {
            const existingItemIndex = currentOrder.findIndex(item => item.id === product.id);

            if (existingItemIndex > -1) {
                currentOrder[existingItemIndex].qty += quantity;
            } else {
                currentOrder.push({ ...product, qty: quantity });
            }
            
            renderOrderList();
        }

        function removeItem(productId) {
            currentOrder = currentOrder.filter(item => item.id !== productId);
            renderOrderList();
        }

        function updateItemQuantity(productId, change) {
            const item = currentOrder.find(item => item.id === productId);
            if (item) {
                item.qty += change;
                if (item.qty <= 0) {
                    removeItem(productId);
                } else {
                    renderOrderList();
                }
            }
        }

        function selectRow(element, productId) {
            if (activeRowElement) {
                activeRowElement.classList.remove('active');
            }
            activeRowElement = element;
            element.classList.add('active');
        }

        function renderOrderList() {
            itemsList.innerHTML = '';
            let total = 0;

            currentOrder.forEach(item => {
                const itemTotal = item.price * item.qty;
                total += itemTotal;
                
                const itemRow = document.createElement('div');
                itemRow.className = 'item-row';
                itemRow.onclick = () => selectRow(itemRow, item.id);

                itemRow.innerHTML = `
                    <span class="item-name">${item.name}</span>
                    <button onclick="event.stopPropagation(); updateItemQuantity(${item.id}, -1)">-</button>
                    <span class="item-qty">${item.qty}</span>
                    <button onclick="event.stopPropagation(); updateItemQuantity(${item.id}, 1)">+</button>
                    <span class="item-price">‚Ç¨ ${itemTotal.toFixed(2).replace('.', ',')}</span>
                    <button class="item-remove" onclick="event.stopPropagation(); removeItem(${item.id})">X</button>
                `;
                itemsList.appendChild(itemRow);
            });

            // Aggiorna tutti i totali
            const formattedTotal = total.toFixed(2).replace('.', ',');
            totalDisplay.textContent = 'Totale: ‚Ç¨ ' + formattedTotal;
            mobileTotal.textContent = '‚Ç¨ ' + formattedTotal;
            mobileTotalFooter.textContent = formattedTotal;
        }

        function clearOrder() {
            if (currentOrder.length > 0) {
                if (confirm('Vuoi cancellare l\'intero ordine?')) {
                    currentOrder = [];
                    renderOrderList();
                    if (activeRowElement) {
                        activeRowElement.classList.remove('active');
                        activeRowElement = null;
                    }
                }
            }
        }

        function checkout() {
            if (currentOrder.length > 0) {
                const total = currentOrder.reduce((sum, item) => sum + (item.price * item.qty), 0);
                alert(`Ordine pagato!\nTotale: ‚Ç¨ ${total.toFixed(2).replace('.', ',')}\nGrazie per l'acquisto!`);
                
                currentOrder = [];
                renderOrderList();
                if (activeRowElement) {
                    activeRowElement.classList.remove('active');
                    activeRowElement = null;
                }
            } else {
                alert("L'ordine √® vuoto. Aggiungi dei prodotti prima di pagare.");
            }
        }

        // Inizializzazione
        function init() {
            renderCategories();
            renderProducts();
            renderOrderList();
        }

        // Avvia l'applicazione
        init();
    </script>
</body>
</html>